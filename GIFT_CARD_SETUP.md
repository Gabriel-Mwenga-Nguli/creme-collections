
# Firestore Data Setup for Gift Cards

For the AI-powered Gift Card feature to work correctly, your application will create documents in a `giftCards` collection in your Firestore database. While the app handles creation, this guide explains the data structure for your reference and for any manual checks or administration you might perform.

## 1. Access Firestore Database

1.  Go to the [Firebase Console](https://console.firebase.google.com/).
2.  Select your Firebase project.
3.  In the left-hand navigation pane, click on **Build > Firestore Database**.

## 2. The `giftCards` Collection

Your application will automatically create this collection when the first gift card is purchased. Each document within this collection represents a unique, purchased gift card.

### Example Gift Card Document Structure:

When a user creates a gift card, a document will be added with the following fields:

*   `code` (Type: `string`) - Example: `ABCD-1234-EFGH-5678` (A unique, 16-character code)
*   `initialBalance` (Type: `number`) - Example: `2500` (The value of the card in KES when purchased)
*   `currentBalance` (Type: `number`) - Example: `2500` (The remaining value on the card)
*   `recipientEmail` (Type: `string`) - Example: `recipient@example.com`
*   `senderName` (Type: `string`) - Example: `Jane Doe`
*   `message` (Type: `string`) - Example: `Happy Birthday! Hope you get something you love.` (Generated by AI)
*   `designImageUrl` (Type: `string`) - Example: `data:image/png;base64,...` (The AI-generated image data URI)
*   `createdAt` (Type: `timestamp`) - Example: (The timestamp when the card was created)
*   `expiryDate` (Type: `timestamp`) - Example: (The timestamp for one year after `createdAt`)
*   `isRedeemed` (Type: `boolean`) - Example: `false` (Indicates if any part of the balance has been used)

### Security Rules

For this feature to function, ensure your Firestore security rules allow authenticated users to create documents in the `giftCards` collection. You may want to add more specific rules later for reading or updating cards (e.g., only by an admin or the recipient).

Add the following rule block inside your `service cloud.firestore` definition in `FIRESTORE_RULES.md`:

```
    // Allow any authenticated user to create a gift card.
    // Reading/updating should be locked down further in a real-world scenario.
    match /giftCards/{giftCardId} {
      allow create: if request.auth != null;
      allow read, write: if request.auth != null; // For admin/redemption logic
    }
```

By understanding this structure, you can better manage and troubleshoot the gift card functionality of your e-commerce platform.
